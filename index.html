<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Vendas</title>

<style>
:root{
  --fundo:#0b1020;
  --cartao:#111827;
  --primaria:#6366f1;
  --sucesso:#22c55e;
  --texto:#e5e7eb;
  --muted:#9ca3af;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--fundo);
  color:var(--texto);
  font-family:Segoe UI, Arial, sans-serif;
}

.layout{
  display:grid;
  grid-template-columns:240px 1fr;
  min-height:100vh;
}

/* MENU LATERAL */
.menu{
  background:#0a0f1e;
  padding:20px;
}

.menu h2{
  color:var(--primaria);
}

.menu button{
  width:100%;
  margin:6px 0;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#1f2937;
  color:var(--texto);
  cursor:pointer;
}

.menu button:hover{
  background:#374151;
}

/* CONTEÚDO */
.conteudo{
  padding:30px;
}

.cartao{
  background:linear-gradient(145deg,#111827,#0f172a);
  padding:20px;
  border-radius:16px;
  margin-bottom:20px;
}

.cartoes{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}

input,select,button{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:none;
  margin-top:8px;
}

.botao-primario{
  background:var(--primaria);
  color:white;
  cursor:pointer;
}

.botao-perigo{
  background:#ef4444;
  color:white;
  margin-top:10px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}

th,td{
  padding:8px;
  border-bottom:1px solid #374151;
  text-align:left;
}

.oculto{display:none}
</style>
</head>

<body>
<div class="layout">

<aside class="menu">
  <h2>Vendas</h2>
  <button onclick="mostrarTela('painel')">Painel</button>
  <button onclick="mostrarTela('historico')">Histórico de vendas</button>
  <button onclick="mostrarTela('anual')">Relatório anual</button>
</aside>

<main class="conteudo">

<!-- PAINEL -->
<div id="painel">
  <div class="cartao">
    <h3>Meta do mês (R$)</h3>
    <input id="meta" placeholder="Ex: 15000">
    <button class="botao-primario" onclick="salvarMeta()">Salvar meta</button>
  </div>

  <div class="cartao">
    <h3>Nova venda</h3>
    <input id="venda" placeholder="Ex: 2.090,00">
    <select id="percentual">
      <option value="6">6%</option>
      <option value="5">5%</option>
      <option value="4">4%</option>
      <option value="3">3%</option>
    </select>
    <button class="botao-primario" onclick="adicionarVenda()">Adicionar venda</button>
  </div>

  <div class="cartoes">
    <div class="cartao"><h4>Meta</h4><h2 id="valorMeta">R$ 0,00</h2></div>
    <div class="cartao"><h4>Total vendido</h4><h2 id="totalVendido">R$ 0,00</h2></div>
    <div class="cartao"><h4>Falta para meta</h4><h2 id="faltaMeta">R$ 0,00</h2></div>
    <div class="cartao"><h4>Comissão total</h4><h2 id="totalComissao" style="color:var(--sucesso)">R$ 0,00</h2></div>
  </div>
</div>

<!-- HISTÓRICO -->
<div id="historico" class="oculto">
  <div class="cartao">
    <h3>Histórico de vendas (mês atual)</h3>
    <table>
      <thead>
        <tr><th>Data</th><th>Valor</th><th>%</th><th>Comissão</th></tr>
      </thead>
      <tbody id="listaVendas"></tbody>
    </table>
    <button class="botao-perigo" onclick="limparMes()">Limpar mês atual</button>
  </div>
</div>

<!-- RELATÓRIO ANUAL -->
<div id="anual" class="oculto">
  <div class="cartao">
    <h3>Relatório anual</h3>
    <table>
      <thead>
        <tr><th>Mês</th><th>Total vendido</th><th>Comissão</th></tr>
      </thead>
      <tbody id="relatorioAnual"></tbody>
    </table>
  </div>
</div>

</main>
</div>

<script>
function converterValor(v){
  if(!v) return 0;
  return Number(v.replace(/\./g,"").replace(",","."));
}

const meses = ["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];

let dados = JSON.parse(localStorage.getItem("controleVendas")) || {
  meta:0,
  vendas:[]
};

function salvarDados(){
  localStorage.setItem("controleVendas",JSON.stringify(dados));
}

function salvarMeta(){
  dados.meta = converterValor(meta.value);
  salvarDados();
  atualizarTela();
}

function adicionarVenda(){
  const valor = converterValor(venda.value);
  if(valor<=0) return alert("Digite um valor de venda válido.");

  const perc = Number(percentual.value);
  const com = valor * perc / 100;

  dados.vendas.push({
    data:new Date().toLocaleDateString("pt-BR"),
    mes:new Date().getMonth(),
    valor, perc, com
  });

  venda.value="";
  salvarDados();
  atualizarTela();
}

function atualizarTela(){
  valorMeta.innerText = dados.meta.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});

  const mesAtual = new Date().getMonth();
  const vendasMes = dados.vendas.filter(v=>v.mes===mesAtual);

  const total = vendasMes.reduce((s,v)=>s+v.valor,0);
  const com = vendasMes.reduce((s,v)=>s+v.com,0);

  totalVendido.innerText = total.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
  totalComissao.innerText = com.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});

  faltaMeta.innerText = Math.max(dados.meta-total,0)
    .toLocaleString("pt-BR",{style:"currency",currency:"BRL"});

  listaVendas.innerHTML="";
  vendasMes.forEach(v=>{
    listaVendas.innerHTML+=`
      <tr>
        <td>${v.data}</td>
        <td>${v.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</td>
        <td>${v.perc}%</td>
        <td>${v.com.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</td>
      </tr>`;
  });

  const anual={};
  dados.vendas.forEach(v=>{
    anual[v.mes]=anual[v.mes]||{v:0,c:0};
    anual[v.mes].v+=v.valor;
    anual[v.mes].c+=v.com;
  });

  relatorioAnual.innerHTML="";
  Object.keys(anual).forEach(m=>{
    relatorioAnual.innerHTML+=`
      <tr>
        <td>${meses[m]}</td>
        <td>${anual[m].v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</td>
        <td>${anual[m].c.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}</td>
      </tr>`;
  });
}

function limparMes(){
  const m = new Date().getMonth();
  dados.vendas = dados.vendas.filter(v=>v.mes!==m);
  salvarDados();
  atualizarTela();
}

function mostrarTela(id){
  painel.classList.add("oculto");
  historico.classList.add("oculto");
  anual.classList.add("oculto");
  document.getElementById(id).classList.remove("oculto");
}

atualizarTela();
</script>

</body>
</html>
