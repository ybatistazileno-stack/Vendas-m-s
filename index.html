<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Profissional de Vendas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
:root{
  --bg:#0b1020; --sidebar:#0a0f1e; --card:#111827;
  --primary:#6366f1; --green:#22c55e; --text:#e5e7eb;
}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial;background:var(--bg);color:var(--text)}
.layout{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
aside{background:var(--sidebar);padding:20px}
aside h2{color:var(--primary)}
aside button{
  width:100%;background:#1f2937;color:#fff;border:none;
  padding:12px;border-radius:10px;margin-bottom:8px;text-align:left;cursor:pointer
}
aside button:hover{background:var(--primary)}
main{padding:25px}
.section{display:none}.section.active{display:block}

.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px}
.card{background:var(--card);padding:20px;border-radius:16px}
.valor{font-size:26px;font-weight:bold}.green{color:var(--green)}

input,select,button{
  width:100%;padding:12px;border-radius:10px;border:none;margin-top:10px
}
button.primary{background:var(--primary);color:#fff;cursor:pointer}

table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #1f2937;text-align:center}
td button{padding:6px 10px;border-radius:6px;border:none;cursor:pointer}

.prod-item{
  background:#1f2937;padding:10px;border-radius:10px;margin-top:10px
}

@media(max-width:900px){
  .layout{grid-template-columns:1fr}
  aside{display:flex;gap:10px;overflow:auto}
}
</style>
</head>

<body>
<div class="layout">

<!-- MENU -->
<aside>
  <h2>Vendas</h2>
  <button onclick="show('painel')">üìä Painel</button>
  <button onclick="show('vendas')">‚ûï Nova venda</button>
  <button onclick="show('historico')">üìÅ Hist√≥rico</button>
  <button onclick="exportarPDF()">üìÑ PDF</button>
  <button onclick="exportarExcel()">üìä Excel</button>
</aside>

<main>

<!-- PAINEL -->
<section id="painel" class="section active">
  <div class="cards">
    <div class="card"><h4>Total vendido</h4><div id="totalVendido" class="valor">R$ 0,00</div></div>
    <div class="card"><h4>Comiss√£o</h4><div id="totalComissao" class="valor green">R$ 0,00</div></div>
  </div>
  <div class="card" style="margin-top:20px">
    <div id="grafico"></div>
  </div>
</section>

<!-- VENDAS -->
<section id="vendas" class="section">
  <div class="card">
    <h3>Nova venda</h3>

    <input id="valorVenda" placeholder="Valor total da venda (ex: 12.500,00)">

    <select id="percentual">
      <option value="6">6% de comiss√£o</option>
      <option value="5">5% de comiss√£o</option>
      <option value="4">4% de comiss√£o</option>
      <option value="3">3% de comiss√£o</option>
    </select>

    <input id="clienteVenda" placeholder="Nome completo do cliente">

    <hr style="margin:20px 0;border-color:#1f2937">

    <h4>Adicionar produtos (somente descritivo)</h4>

    <select id="grupoProduto">
      <option value="">Grupo</option>
      <option value="Produtos">Produtos</option>
      <option value="Acess√≥rios">Acess√≥rios</option>
    </select>

    <input id="tipoProduto" placeholder="Tipo (ex: Colch√£o, Base, Travesseiro)">
    <input id="descricaoProduto" placeholder="Descri√ß√£o / Modelo">
    <input id="quantidadeProduto" type="number" min="1" placeholder="Quantidade">

    <button class="primary" onclick="addProdutoTemp()">Adicionar item</button>

    <div id="listaTemp"></div>

    <button class="primary" style="margin-top:20px" onclick="salvarVenda()">Salvar venda</button>
  </div>
</section>

<!-- HIST√ìRICO -->
<section id="historico" class="section">
  <div class="card">
    <h3>Hist√≥rico de vendas</h3>
    <table>
      <thead>
        <tr>
          <th>Data</th>
          <th>Cliente</th>
          <th>Venda</th>
          <th>Comiss√£o</th>
          <th>Detalhes</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody id="listaVendas"></tbody>
    </table>
  </div>
</section>

</main>
</div>

<script>
function num(v){return Number(v.replace(/\./g,"").replace(",","."))}
function moeda(v){return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}

let dados = JSON.parse(localStorage.getItem("controleVendas")) || { vendas:[] };
let itensTemp = [];

function show(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function addProdutoTemp(){
  let grupo=grupoProduto.value;
  let tipo=tipoProduto.value.trim();
  let desc=descricaoProduto.value.trim();
  let qtd=Number(quantidadeProduto.value);

  if(!grupo||!tipo||qtd<=0){
    alert("Preencha grupo, tipo e quantidade");
    return;
  }

  itensTemp.push({grupo,tipo,descricao:desc,quantidade:qtd});
  renderTemp();

  tipoProduto.value="";
  descricaoProduto.value="";
  quantidadeProduto.value="";
}

function renderTemp(){
  listaTemp.innerHTML="";
  itensTemp.forEach((i,idx)=>{
    listaTemp.innerHTML+=`
      <div class="prod-item">
        ${i.grupo} ‚Äì ${i.tipo} ‚Äì ${i.descricao||"‚Äî"} (Qtd: ${i.quantidade})
        <button style="float:right" onclick="removerTemp(${idx})">üóëÔ∏è</button>
      </div>`;
  });
}

function removerTemp(i){
  itensTemp.splice(i,1);
  renderTemp();
}

function salvarVenda(){
  let valor=num(valorVenda.value);
  let cliente=clienteVenda.value.trim();
  let p=Number(percentual.value);

  if(valor<=0||!cliente||itensTemp.length===0){
    alert("Preencha valor, cliente e adicione produtos");
    return;
  }

  dados.vendas.push({
    id:Date.now(),
    valor,cliente,perc:p,
    com:valor*p/100,
    itens:JSON.parse(JSON.stringify(itensTemp)),
    data:new Date()
  });

  valorVenda.value="";
  clienteVenda.value="";
  itensTemp=[];
  listaTemp.innerHTML="";

  salvar();
}

function salvar(){
  localStorage.setItem("controleVendas",JSON.stringify(dados));
  atualizar();
}

function excluir(id){
  if(confirm("Excluir venda?")){
    dados.vendas=dados.vendas.filter(v=>v.id!==id);
    salvar();
  }
}

let chart;
function atualizar(){
  let total=dados.vendas.reduce((a,b)=>a+b.valor,0);
  let com=dados.vendas.reduce((a,b)=>a+b.com,0);

  totalVendido.innerText=moeda(total);
  totalComissao.innerText=moeda(com);

  listaVendas.innerHTML="";
  dados.vendas.forEach(v=>{
    listaVendas.innerHTML+=`
      <tr>
        <td>${v.data.toLocaleDateString("pt-BR")}</td>
        <td>${v.cliente}</td>
        <td>${moeda(v.valor)}</td>
        <td>${moeda(v.com)}</td>
        <td>${v.itens.map(i=>`${i.tipo} (${i.quantidade})`).join("<br>")}</td>
        <td><button onclick="excluir(${v.id})">üóëÔ∏è</button></td>
      </tr>`;
  });

  if(chart)chart.destroy();
  chart=new ApexCharts(document.querySelector("#grafico"),{
    chart:{height:300},
    series:[{name:"Vendas",data:dados.vendas.map(v=>v.valor)}],
    xaxis:{categories:dados.vendas.map(v=>v.data.toLocaleDateString("pt-BR"))}
  });
  chart.render();
}

function exportarPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  pdf.text("Relat√≥rio de Vendas",10,10);
  let y=20;
  dados.vendas.forEach(v=>{
    pdf.text(`${v.data.toLocaleDateString("pt-BR")} - ${v.cliente} - ${moeda(v.valor)}`,10,y);
    y+=8;
  });
  pdf.save("vendas.pdf");
}

function exportarExcel(){
  let ws=XLSX.utils.json_to_sheet(dados.vendas.map(v=>({
    Data:v.data.toLocaleDateString("pt-BR"),
    Cliente:v.cliente,
    Valor:v.valor,
    Comiss√£o:v.com
  })));
  let wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Vendas");
  XLSX.writeFile(wb,"vendas.xlsx");
}

atualizar();
</script>
</body>
</html>
