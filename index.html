<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Profissional de Vendas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ApexCharts -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<style>
:root{
  --bg:#0b1020;
  --sidebar:#0a0f1e;
  --card:#111827;
  --primary:#6366f1;
  --green:#22c55e;
  --red:#ef4444;
  --text:#e5e7eb;
  --muted:#9ca3af;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:var(--bg);
  color:var(--text);
}
.layout{
  display:grid;
  grid-template-columns:240px 1fr;
  min-height:100vh;
}
aside{
  background:var(--sidebar);
  padding:20px;
}
aside h2{
  color:var(--primary);
  margin-bottom:20px;
}
aside button{
  width:100%;
  background:#1f2937;
  color:white;
  border:none;
  padding:12px;
  border-radius:10px;
  margin-bottom:8px;
  cursor:pointer;
  text-align:left;
}
aside button:hover{
  background:var(--primary);
}
main{
  padding:25px;
}
.section{display:none}
.section.active{display:block}

.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}
.card{
  background:var(--card);
  padding:20px;
  border-radius:16px;
}
.valor{
  font-size:26px;
  font-weight:bold;
}
.green{color:var(--green)}
input,select,button{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-top:10px;
}
button.primary{
  background:var(--primary);
  color:white;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  padding:10px;
  border-bottom:1px solid #1f2937;
  text-align:center;
}
td button{
  padding:6px 10px;
  border-radius:6px;
  border:none;
  cursor:pointer;
}
@media(max-width:800px){
  .layout{grid-template-columns:1fr}
  aside{display:flex;overflow:auto;gap:10px}
  aside button{text-align:center}
}
</style>
</head>

<body>
<div class="layout">

<!-- SIDEBAR -->
<aside>
  <h2>Vendas</h2>
  <button onclick="show('painel')">üìä Painel</button>
  <button onclick="show('vendas')">‚ûï Lan√ßar venda</button>
  <button onclick="show('historico')">üìÅ Hist√≥rico</button>
  <button onclick="show('graficos')">üìà Gr√°ficos</button>
  <button onclick="show('relatorio')">üìÜ Relat√≥rio anual</button>
</aside>

<!-- MAIN -->
<main>

<!-- PAINEL -->
<section id="painel" class="section active">
  <div class="cards">
    <div class="card"><h4>Meta do m√™s</h4><div id="metaValor" class="valor">R$ 0,00</div></div>
    <div class="card"><h4>Total vendido</h4><div id="totalVendido" class="valor">R$ 0,00</div></div>
    <div class="card"><h4>Falta para meta</h4><div id="faltaMeta" class="valor">R$ 0,00</div></div>
    <div class="card"><h4>Comiss√£o</h4><div id="totalComissao" class="valor green">R$ 0,00</div></div>
  </div>
</section>

<!-- VENDAS -->
<section id="vendas" class="section">
  <div class="card">
    <h3>Meta do m√™s</h3>
    <input id="metaInput" placeholder="Ex: 15.000,00">
    <button class="primary" onclick="salvarMeta()">Salvar meta</button>
  </div>

  <div class="card">
    <h3>Nova venda</h3>
    <input id="vendaInput" placeholder="Ex: 2.090,00">
    <select id="percentual">
      <option value="6">6%</option>
      <option value="5">5%</option>
      <option value="4">4%</option>
      <option value="3">3%</option>
    </select>
    <button class="primary" onclick="adicionarVenda()">Adicionar venda</button>
  </div>
</section>

<!-- HIST√ìRICO -->
<section id="historico" class="section">
  <div class="card">
    <h3>Hist√≥rico de vendas</h3>
    <table>
      <thead>
        <tr><th>Data</th><th>Valor</th><th>%</th><th>Comiss√£o</th><th>A√ß√µes</th></tr>
      </thead>
      <tbody id="listaVendas"></tbody>
    </table>
  </div>
</section>

<!-- GR√ÅFICOS -->
<section id="graficos" class="section">
  <div class="card">
    <h3>Vendas (Linha + Barra)</h3>
    <div id="grafico"></div>
  </div>
</section>

<!-- RELAT√ìRIO -->
<section id="relatorio" class="section">
  <div class="card">
    <h3>Relat√≥rio anual</h3>
    <table>
      <thead><tr><th>M√™s</th><th>Total vendido</th><th>Comiss√£o</th></tr></thead>
      <tbody id="relatorioAnual"></tbody>
    </table>
  </div>
</section>

</main>
</div>

<script>
// ================= FUN√á√ïES FINANCEIRAS =================
function paraNumero(v){
  return Number(v.replace(/\./g,"").replace(",","."));
}
function moeda(v){
  return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
}

// ================= DADOS =================
let dados = JSON.parse(localStorage.getItem("controleVendas")) || {
  meta:0,
  vendas:[]
};

// ================= NAVEGA√á√ÉO =================
function show(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

// ================= A√á√ïES =================
function salvarMeta(){
  dados.meta = paraNumero(metaInput.value||"0");
  salvar();
}
function adicionarVenda(){
  let valor = paraNumero(vendaInput.value);
  if(valor<=0) return alert("Valor inv√°lido");
  let p = Number(percentual.value);
  dados.vendas.push({
    id:Date.now(),
    valor,
    perc:p,
    com:valor*p/100,
    data:new Date()
  });
  vendaInput.value="";
  salvar();
}
function editar(id){
  let v = dados.vendas.find(v=>v.id===id);
  let novo = prompt("Novo valor:", moeda(v.valor));
  if(!novo) return;
  v.valor = paraNumero(novo);
  v.com = v.valor*v.perc/100;
  salvar();
}
function excluir(id){
  if(confirm("Excluir venda?")){
    dados.vendas = dados.vendas.filter(v=>v.id!==id);
    salvar();
  }
}
function salvar(){
  localStorage.setItem("controleVendas",JSON.stringify(dados));
  atualizar();
}

// ================= ATUALIZA =================
let chart;
function atualizar(){
  let total = dados.vendas.reduce((s,v)=>s+v.valor,0);
  let com = dados.vendas.reduce((s,v)=>s+v.com,0);

  metaValor.innerText = moeda(dados.meta);
  totalVendido.innerText = moeda(total);
  faltaMeta.innerText = moeda(Math.max(dados.meta-total,0));
  totalComissao.innerText = moeda(com);

  listaVendas.innerHTML="";
  dados.vendas.forEach(v=>{
    listaVendas.innerHTML+=`
    <tr>
      <td>${v.data.toLocaleDateString("pt-BR")}</td>
      <td>${moeda(v.valor)}</td>
      <td>${v.perc}%</td>
      <td>${moeda(v.com)}</td>
      <td>
        <button onclick="editar(${v.id})">‚úèÔ∏è</button>
        <button onclick="excluir(${v.id})">üóëÔ∏è</button>
      </td>
    </tr>`;
  });

  let meses = Array(12).fill(0);
  dados.vendas.forEach(v=>meses[v.data.getMonth()]+=v.valor);

  relatorioAnual.innerHTML="";
  meses.forEach((v,i)=>{
    relatorioAnual.innerHTML+=`<tr><td>${i+1}</td><td>${moeda(v)}</td><td>${moeda(v*0.06)}</td></tr>`;
  });

  if(chart) chart.destroy();
  chart = new ApexCharts(document.querySelector("#grafico"),{
    chart:{type:"line",height:350,toolbar:{show:false}},
    series:[
      {name:"Vendas",type:"column",data:meses},
      {name:"Evolu√ß√£o",type:"line",data:meses}
    ],
    xaxis:{categories:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"]},
    colors:["#6366f1","#22c55e"]
  });
  chart.render();
}

atualizar();
</script>
</body>
</html>
