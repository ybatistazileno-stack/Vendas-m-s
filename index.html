<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Vendas</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:Segoe UI, Arial;
  background:#0b1020;
  color:#fff;
}

/* LOGIN */
#login{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.login-box{
  background:#111827;
  padding:30px;
  border-radius:15px;
  width:320px;
}
.login-box h2{text-align:center}
input,select,button{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:none;
  margin-top:10px;
}
button{
  background:#6366f1;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}

/* SISTEMA */
#sistema{display:none}
.container{max-width:1100px;margin:auto;padding:20px}
.card{
  background:#111827;
  padding:20px;
  border-radius:15px;
  margin-bottom:20px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:15px;
}
.logout{
  background:#ef4444;
  margin-top:10px;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:8px;
  border-bottom:1px solid #333;
  text-align:center;
}
th{color:#9ca3af}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
  <div class="login-box">
    <h2>Login</h2>
    <input id="loginUser" placeholder="Usuário">
    <input id="loginPass" type="password" placeholder="Senha">
    <button onclick="login()">Entrar</button>
  </div>
</div>

<!-- SISTEMA -->
<div id="sistema">
  <div class="container">

    <div class="card">
      <h2>Painel de Vendas</h2>
      <p>Usuário: <b id="userInfo"></b></p>
      <button class="logout" onclick="logout()">Sair</button>
    </div>

    <div class="grid">
      <div class="card">
        <h3>Meta do mês</h3>
        <input id="metaInput" type="number" placeholder="Ex: 15000">
        <button onclick="salvarMeta()" id="btnMeta">Salvar meta</button>
      </div>

      <div class="card">
        <h3>Nova venda</h3>
        <input id="vendaInput" placeholder="Ex: 2090.00">
        <select id="percentual">
          <option value="6">6%</option>
          <option value="5">5%</option>
          <option value="4">4%</option>
        </select>
        <button onclick="adicionarVenda()" id="btnVenda">Adicionar venda</button>
      </div>
    </div>

    <div class="grid">
      <div class="card">Meta<br><b>R$ <span id="meta">0.00</span></b></div>
      <div class="card">Total vendido<br><b>R$ <span id="total">0.00</span></b></div>
      <div class="card">Comissão<br><b style="color:#22c55e">R$ <span id="comissao">0.00</span></b></div>
    </div>

    <div class="card">
      <h3>Gráfico mensal de vendas</h3>
      <canvas id="grafico"></canvas>
    </div>

    <div class="card">
      <h3>Histórico de vendas</h3>
      <table>
        <thead>
          <tr>
            <th>Data</th>
            <th>Venda</th>
            <th>%</th>
            <th>Comissão</th>
            <th>Ação</th>
          </tr>
        </thead>
        <tbody id="lista"></tbody>
      </table>
    </div>

  </div>
</div>

<script>
const usuarios={
  admin:{senha:"Admin@2026",tipo:"admin"},
  visitante:{senha:"123456",tipo:"visitante"}
};

let dados=JSON.parse(localStorage.getItem("dados"))||{
  meta:0,
  vendas:[],
  usuario:null
};

let chart;

function login(){
  const u=loginUser.value;
  const s=loginPass.value;
  if(!usuarios[u]||usuarios[u].senha!==s){
    alert("Login inválido");
    return;
  }
  dados.usuario={nome:u,tipo:usuarios[u].tipo};
  salvar();
  iniciar();
}

function logout(){
  dados.usuario=null;
  salvar();
  location.reload();
}

function salvar(){
  localStorage.setItem("dados",JSON.stringify(dados));
}

function iniciar(){
  login.style.display="none";
  sistema.style.display="block";
  userInfo.innerText=dados.usuario.nome+" ("+dados.usuario.tipo+")";
  atualizar();
  if(dados.usuario.tipo!=="admin"){
    btnMeta.disabled=true;
    btnVenda.disabled=true;
  }
}

function salvarMeta(){
  if(dados.usuario.tipo!=="admin")return;
  dados.meta=Number(metaInput.value);
  salvar();
  atualizar();
}

function adicionarVenda(){
  if(dados.usuario.tipo!=="admin")return;
  const v=Number(vendaInput.value.replace(",",".")); 
  if(v<=0)return;
  const p=Number(percentual.value);
  dados.vendas.push({
    data:new Date().toLocaleDateString("pt-BR"),
    valor:v,
    perc:p,
    com:v*p/100
  });
  salvar();
  vendaInput.value="";
  atualizar();
}

function atualizar(){
  meta.innerText=dados.meta.toFixed(2);
  let total=0,com=0;
  lista.innerHTML="";
  const labels=[];
  const valores=[];
  dados.vendas.forEach((v,i)=>{
    total+=v.valor; com+=v.com;
    labels.push(v.data);
    valores.push(v.valor);
    lista.innerHTML+=`
      <tr>
        <td>${v.data}</td>
        <td>R$ ${v.valor.toFixed(2)}</td>
        <td>${v.perc}%</td>
        <td>R$ ${v.com.toFixed(2)}</td>
        <td>${dados.usuario.tipo==="admin"?
          `<button onclick="excluir(${i})">X</button>`:""}
        </td>
      </tr>`;
  });
  total.innerText=total.toFixed(2);
  comissao.innerText=com.toFixed(2);
  grafico(labels,valores);
}

function excluir(i){
  if(dados.usuario.tipo!=="admin")return;
  dados.vendas.splice(i,1);
  salvar();
  atualizar();
}

function grafico(labels,valores){
  if(chart)chart.destroy();
  chart=new Chart(document.getElementById("grafico"),{
    type:"line",
    data:{
      labels,
      datasets:[{
        label:"Vendas",
        data:valores,
        borderColor:"#6366f1",
        backgroundColor:"rgba(99,102,241,.2)",
        tension:.4,
        fill:true
      }]
    },
    options:{
      responsive:true,
      plugins:{legend:{display:false}}
    }
  });
}

if(dados.usuario) iniciar();
</script>

</body>
</html>

