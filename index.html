<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Profissional de Vendas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:#0b1020;
  color:#e5e7eb;
}
.container{
  max-width:1200px;
  margin:auto;
  padding:20px;
}
.card{
  background:#111827;
  padding:20px;
  border-radius:14px;
  margin-bottom:20px;
}
input,select,button{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:10px;
  border:none;
}
button{
  background:#6366f1;
  color:white;
  font-weight:600;
  cursor:pointer;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}
.valor{font-size:22px;font-weight:700}
.green{color:#22c55e}
.red{background:#ef4444}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:10px;
  border-bottom:1px solid #2a2a3a;
  text-align:center;
}
canvas{
  background:#0f172a;
  border-radius:14px;
}
</style>
</head>

<body>
<div class="container">

<h1>üìä Controle de Vendas</h1>

<div class="card">
<h2>Meta do m√™s</h2>
<input id="metaInput" placeholder="Ex: 15.000,00">
<button onclick="salvarMeta()">Salvar meta</button>
</div>

<div class="card">
<h2>Nova venda</h2>
<input id="vendaInput" placeholder="Ex: 2.090,00">
<select id="percentualInput">
<option value="6">6%</option>
<option value="5">5%</option>
<option value="4">4%</option>
<option value="3">3%</option>
</select>
<button onclick="adicionarVenda()">Adicionar venda</button>
</div>

<div class="grid">
<div class="card"><h3>Meta</h3><div class="valor" id="metaValor">R$ 0,00</div></div>
<div class="card"><h3>Total vendido</h3><div class="valor" id="totalVendido">R$ 0,00</div></div>
<div class="card"><h3>Falta para meta</h3><div class="valor" id="faltaMeta">R$ 0,00</div></div>
<div class="card"><h3>Comiss√£o</h3><div class="valor green" id="totalComissao">R$ 0,00</div></div>
</div>

<div class="card">
<h2>Gr√°fico anual</h2>
<canvas id="grafico"></canvas>
</div>

<div class="card">
<h2>Relat√≥rio de vendas</h2>
<button onclick="gerarPDF()">üìÑ Gerar PDF do m√™s</button>
<table>
<thead>
<tr>
<th>Data</th>
<th>Venda</th>
<th>%</th>
<th>Comiss√£o</th>
<th>A√ß√µes</th>
</tr>
</thead>
<tbody id="historico"></tbody>
</table>
</div>

</div>

<script>
// ===== FUN√á√ïES FINANCEIRAS =====
function paraNumero(valor){
  return Number(
    valor.replace(/\s/g,"").replace(/\./g,"").replace(",",".")
  );
}
function moeda(v){
  return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
}

// ===== DADOS =====
let dados = JSON.parse(localStorage.getItem("controleVendas")) || {
  meta:0,
  vendas:[]
};

// ===== A√á√ïES =====
function salvarMeta(){
  dados.meta = paraNumero(metaInput.value||"0");
  salvar();
}

function adicionarVenda(){
  let valor = paraNumero(vendaInput.value);
  if(valor<=0)return alert("Valor inv√°lido");

  let perc = Number(percentualInput.value);
  dados.vendas.push({
    id:Date.now(),
    valor,
    perc,
    comissao:valor*perc/100,
    data:new Date().toISOString()
  });
  vendaInput.value="";
  salvar();
}

function editarVenda(id){
  let v = dados.vendas.find(v=>v.id===id);
  let novoValor = prompt("Novo valor da venda:", moeda(v.valor));
  if(!novoValor) return;
  v.valor = paraNumero(novoValor);
  let novoPerc = prompt("Novo percentual:", v.perc);
  v.perc = Number(novoPerc);
  v.comissao = v.valor*v.perc/100;
  salvar();
}

function excluirVenda(id){
  if(confirm("Excluir esta venda?")){
    dados.vendas = dados.vendas.filter(v=>v.id!==id);
    salvar();
  }
}

function salvar(){
  localStorage.setItem("controleVendas",JSON.stringify(dados));
  atualizar();
}

// ===== ATUALIZA =====
let grafico;
function atualizar(){
  let totalV = dados.vendas.reduce((s,v)=>s+v.valor,0);
  let totalC = dados.vendas.reduce((s,v)=>s+v.comissao,0);
  let falta = Math.max(dados.meta-totalV,0);

  metaValor.innerText = moeda(dados.meta);
  totalVendido.innerText = moeda(totalV);
  totalComissao.innerText = moeda(totalC);
  faltaMeta.innerText = moeda(falta);

  historico.innerHTML = dados.vendas.map(v=>`
    <tr>
      <td>${new Date(v.data).toLocaleDateString("pt-BR")}</td>
      <td>${moeda(v.valor)}</td>
      <td>${v.perc}%</td>
      <td>${moeda(v.comissao)}</td>
      <td>
        <button onclick="editarVenda(${v.id})">‚úèÔ∏è</button>
        <button class="red" onclick="excluirVenda(${v.id})">üóëÔ∏è</button>
      </td>
    </tr>
  `).join("");

  let meses = Array(12).fill(0);
  dados.vendas.forEach(v=>{
    meses[new Date(v.data).getMonth()] += v.valor;
  });

  if(grafico) grafico.destroy();
  grafico = new Chart(document.getElementById("grafico"),{
    type:"bar",
    data:{
      labels:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],
      datasets:[{label:"Vendas",data:meses,backgroundColor:"#6366f1"}]
    }
  });
}

// ===== PDF =====
function gerarPDF(){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  pdf.text("Relat√≥rio de Vendas - M√™s Atual",10,10);
  let y=20;
  dados.vendas.forEach(v=>{
    pdf.text(
      `${new Date(v.data).toLocaleDateString("pt-BR")} - ${moeda(v.valor)} - ${v.perc}%`,
      10,y
    );
    y+=8;
  });
  pdf.save("relatorio-vendas.pdf");
}

atualizar();
</script>
</body>
</html>
