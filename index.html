<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Profissional de Vendas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<style>
:root{
  --bg:#0b1020;
  --sidebar:#0a0f1e;
  --card:#111827;
  --primary:#6366f1;
  --green:#22c55e;
  --orange:#f59e0b;
  --red:#ef4444;
  --text:#e5e7eb;
  --muted:#9ca3af;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:var(--bg);
  color:var(--text);
}
.layout{
  display:grid;
  grid-template-columns:260px 1fr;
  min-height:100vh;
}
aside{
  background:var(--sidebar);
  padding:20px;
}
aside h2{
  color:var(--primary);
  margin-bottom:20px;
}
aside button{
  width:100%;
  background:#1f2937;
  color:#fff;
  border:none;
  padding:12px;
  border-radius:10px;
  margin-bottom:8px;
  text-align:left;
  cursor:pointer;
}
aside button:hover{background:var(--primary)}
main{padding:25px}

.section{display:none}
.section.active{display:block}

/* CARDS */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}
.card{
  background:var(--card);
  padding:20px;
  border-radius:16px;
}
.valor{
  font-size:26px;
  font-weight:bold;
}
.green{color:var(--green)}
.orange{color:var(--orange)}
.red{color:var(--red)}
.muted{color:var(--muted)}

/* DONUTS */
.donuts{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;
  margin-top:20px;
}

/* FORM */
input,select,button{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-top:10px;
}
button.primary{
  background:var(--primary);
  color:#fff;
  cursor:pointer;
}

/* HIST√ìRICO */
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:10px;
  border-bottom:1px solid #1f2937;
  text-align:left;
  vertical-align:top;
}
td small{color:var(--muted)}

.item-chip{
  background:#1f2937;
  padding:6px 10px;
  border-radius:8px;
  display:inline-block;
  margin:2px 0;
  font-size:13px;
}

@media(max-width:900px){
  .layout{grid-template-columns:1fr}
  aside{display:flex;gap:10px;overflow:auto}
}
</style>
</head>

<body>
<div class="layout">

<!-- MENU -->
<aside>
  <h2>Vendas</h2>
  <button onclick="show('painel')">üìä Painel</button>
  <button onclick="show('vendas')">‚ûï Nova venda</button>
  <button onclick="show('historico')">üìÅ Hist√≥rico</button>
</aside>

<main>

<!-- PAINEL -->
<section id="painel" class="section active">

  <div class="cards">
    <div class="card">
      <div class="muted">Meta do m√™s</div>
      <input id="metaMes" placeholder="Ex: 50.000,00" onblur="salvarMeta()">
      <div id="metaValor" class="valor">R$ 0,00</div>
    </div>

    <div class="card">
      <div class="muted">Total vendido</div>
      <div id="totalVendido" class="valor">R$ 0,00</div>
    </div>

    <div class="card">
      <div class="muted">Falta para meta</div>
      <div id="faltaMeta" class="valor red">R$ 0,00</div>
    </div>

    <div class="card">
      <div class="muted">Comiss√£o total</div>
      <div id="totalComissao" class="valor green">R$ 0,00</div>
    </div>
  </div>

  <div class="donuts">
    <div class="card">
      <h4>Vendas x Comiss√£o</h4>
      <div id="donutFinanceiro"></div>
    </div>

    <div class="card">
      <h4>Melhor m√™s</h4>
      <div id="donutMes"></div>
    </div>

    <div class="card">
      <h4>Melhor semana</h4>
      <div id="donutSemana"></div>
    </div>
  </div>

</section>

<!-- VENDAS -->
<section id="vendas" class="section">
  <div class="card">
    <h3>Nova venda</h3>

    <input id="valorVenda" placeholder="Valor total da venda (ex: 12.500,00)">

    <select id="percentual">
      <option value="6">6% de comiss√£o</option>
      <option value="5">5% de comiss√£o</option>
      <option value="4">4% de comiss√£o</option>
      <option value="3">3% de comiss√£o</option>
    </select>

    <input id="clienteVenda" placeholder="Nome completo do cliente">

    <hr style="margin:20px 0;border-color:#1f2937">

    <h4>Itens da venda</h4>

    <select id="grupoItem">
      <option value="">Grupo</option>
      <option value="Produtos">Produtos</option>
      <option value="Acess√≥rios">Acess√≥rios</option>
    </select>

    <select id="tipoItem">
      <option value="">Tipo</option>
      <option value="Colch√£o">Colch√£o</option>
      <option value="Base">Base</option>
      <option value="Acess√≥rio">Acess√≥rio</option>
    </select>

    <input id="descricaoItem" placeholder="Descri√ß√£o / nome do produto">
    <input id="quantidadeItem" type="number" min="1" placeholder="Quantidade">

    <button class="primary" onclick="adicionarItem()">Adicionar item</button>

    <div id="listaItens" style="margin-top:15px"></div>

    <button class="primary" style="margin-top:20px" onclick="salvarVenda()">Salvar venda</button>
  </div>
</section>

<!-- HIST√ìRICO -->
<section id="historico" class="section">
  <div class="card">
    <h3>Hist√≥rico de vendas</h3>
    <table>
      <thead>
        <tr>
          <th>Data</th>
          <th>Cliente</th>
          <th>Venda</th>
          <th>Itens</th>
        </tr>
      </thead>
      <tbody id="listaVendas"></tbody>
    </table>
  </div>
</section>

</main>
</div>

<script>
function num(v){return Number(v.replace(/\./g,"").replace(",","."))}
function moeda(v){return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}

let dados = JSON.parse(localStorage.getItem("controleVendas")) || {
  vendas:[],
  meta:0
};
let itensTemp=[];

function show(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* META */
function salvarMeta(){
  dados.meta = num(metaMes.value || "0");
  salvar();
}

/* ITENS */
function adicionarItem(){
  let grupo=grupoItem.value;
  let tipo=tipoItem.value;
  let desc=descricaoItem.value.trim();
  let qtd=Number(quantidadeItem.value);

  if(!grupo||!tipo||qtd<=0){
    alert("Preencha grupo, tipo e quantidade");
    return;
  }

  let existente=itensTemp.find(i=>i.grupo==grupo&&i.tipo==tipo&&i.descricao==desc);
  if(existente){
    existente.quantidade+=qtd;
  }else{
    itensTemp.push({grupo,tipo,descricao:desc,quantidade:qtd});
  }

  renderItens();
  descricaoItem.value="";
  quantidadeItem.value="";
}

function renderItens(){
  listaItens.innerHTML="";
  itensTemp.forEach(i=>{
    listaItens.innerHTML+=`
      <div class="item-chip">
        ${i.tipo} ‚Äì ${i.descricao || "Sem descri√ß√£o"} | Qtd: ${i.quantidade}
      </div>
    `;
  });
}

/* VENDAS */
function salvarVenda(){
  let valor=num(valorVenda.value);
  let cliente=clienteVenda.value.trim();
  let p=Number(percentual.value);

  if(valor<=0||!cliente){
    alert("Preencha valor e cliente");
    return;
  }

  dados.vendas.push({
    valor,cliente,perc:p,
    com:valor*p/100,
    itens:JSON.parse(JSON.stringify(itensTemp)),
    data:new Date()
  });

  valorVenda.value="";
  clienteVenda.value="";
  itensTemp=[];
  listaItens.innerHTML="";

  salvar();
}

function salvar(){
  localStorage.setItem("controleVendas",JSON.stringify(dados));
  atualizar();
}

/* DASHBOARD */
let donut1,donut2,donut3;
function atualizar(){
  let total=dados.vendas.reduce((a,b)=>a+b.valor,0);
  let com=dados.vendas.reduce((a,b)=>a+b.com,0);

  totalVendido.innerText=moeda(total);
  totalComissao.innerText=moeda(com);
  metaValor.innerText=moeda(dados.meta);
  faltaMeta.innerText=moeda(Math.max(dados.meta-total,0));

  if(donut1)donut1.destroy();
  donut1=new ApexCharts(document.querySelector("#donutFinanceiro"),{
    chart:{type:"donut",height:220},
    series:[total,com],
    labels:["Vendido","Comiss√£o"],
    colors:["#6366f1","#22c55e"]
  });
  donut1.render();

  let meses={};
  dados.vendas.forEach(v=>{
    let m=v.data.getMonth();
    meses[m]=(meses[m]||0)+v.valor;
  });
  let melhorMes=Math.max(...Object.values(meses),0);

  if(donut2)donut2.destroy();
  donut2=new ApexCharts(document.querySelector("#donutMes"),{
    chart:{type:"donut",height:220},
    series:[melhorMes, total-melhorMes],
    labels:["Melhor m√™s","Outros"],
    colors:["#f59e0b","#1f2937"]
  });
  donut2.render();

  if(donut3)donut3.destroy();
  donut3=new ApexCharts(document.querySelector("#donutSemana"),{
    chart:{type:"donut",height:220},
    series:[dados.vendas.length, Math.max(1,10-dados.vendas.length)],
    labels:["Vendas","Outras"],
    colors:["#22c55e","#1f2937"]
  });
  donut3.render();

  listaVendas.innerHTML="";
  dados.vendas.forEach(v=>{
    listaVendas.innerHTML+=`
      <tr>
        <td>${v.data.toLocaleDateString("pt-BR")}</td>
        <td>${v.cliente}</td>
        <td>${moeda(v.valor)}<br><small>Comiss√£o: ${moeda(v.com)}</small></td>
        <td>
          ${v.itens.map(i =>
            `${i.tipo} ‚Äì ${i.descricao || "Sem descri√ß√£o"} | Qtd: ${i.quantidade}`
          ).join("<br>")}
        </td>
      </tr>`;
  });
}

metaMes.value = dados.meta ? moeda(dados.meta) : "";
atualizar();
</script>
</body>
</html>
