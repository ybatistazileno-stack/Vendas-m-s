<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard Corporativo de Vendas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ApexCharts -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- SheetJS -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
:root{
  --bg:#0b1020;
  --sidebar:#0a0f1e;
  --card:#111827;
  --primary:#6366f1;
  --green:#22c55e;
  --red:#ef4444;
  --text:#e5e7eb;
  --muted:#9ca3af;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:var(--bg);
  color:var(--text);
}
.layout{
  display:grid;
  grid-template-columns:260px 1fr;
  min-height:100vh;
}
aside{
  background:var(--sidebar);
  padding:20px;
}
aside h2{
  color:var(--primary);
  margin-bottom:20px;
}
aside button{
  width:100%;
  background:#1f2937;
  color:white;
  border:none;
  padding:12px;
  border-radius:10px;
  margin-bottom:8px;
  text-align:left;
  cursor:pointer;
}
aside button:hover{background:var(--primary)}
main{padding:25px}
.section{display:none}
.section.active{display:block}

.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}
.card{
  background:var(--card);
  padding:20px;
  border-radius:16px;
}
.valor{font-size:26px;font-weight:bold}
.green{color:var(--green)}

.progress{
  background:#1f2937;
  border-radius:10px;
  height:14px;
  overflow:hidden;
}
.progress div{
  height:100%;
  background:linear-gradient(90deg,#6366f1,#22c55e);
  width:0%;
}

input,select,button{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-top:10px;
}
button.primary{
  background:var(--primary);
  color:white;
}

table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:10px;
  border-bottom:1px solid #1f2937;
  text-align:center;
}
td button{
  padding:6px 10px;
  border-radius:6px;
  border:none;
  cursor:pointer;
}

@media(max-width:900px){
  .layout{grid-template-columns:1fr}
  aside{display:flex;gap:10px;overflow:auto}
}
</style>
</head>

<body>
<div class="layout">

<!-- SIDEBAR -->
<aside>
  <h2>Vendas</h2>
  <button onclick="show('painel')">üìä Painel</button>
  <button onclick="show('planejamento')">üß† Planejamento</button>
  <button onclick="show('vendas')">‚ûï Lan√ßar venda</button>
  <button onclick="show('historico')">üìÅ Hist√≥rico</button>
  <button onclick="show('relatorio')">üìÜ Relat√≥rios</button>
  <button onclick="exportarPDF()">üìÑ Exportar PDF</button>
  <button onclick="exportarExcel()">üìä Exportar Excel</button>
</aside>

<main>

<!-- PAINEL -->
<section id="painel" class="section active">

<div class="cards">
  <div class="card">
    <h4>Meta do m√™s</h4>
    <div id="metaValor" class="valor">R$ 0,00</div>
    <div class="progress"><div id="barraMeta"></div></div>
    <small id="percentualMeta">0%</small>
  </div>

  <div class="card"><h4>Total vendido</h4><div id="totalVendido" class="valor">R$ 0,00</div></div>
  <div class="card"><h4>Falta para meta</h4><div id="faltaMeta" class="valor">R$ 0,00</div></div>
  <div class="card"><h4>Comiss√£o</h4><div id="totalComissao" class="valor green">R$ 0,00</div></div>
</div>

<div class="cards" style="margin-top:15px">
  <div class="card"><h4>Crescimento (%)</h4><div id="crescimento" class="valor">0%</div></div>
  <div class="card"><h4>Melhor m√™s</h4><div id="melhorMes" class="valor">‚Äî</div></div>
</div>

<div class="card" style="margin-top:20px">
  <h3>Vendas ‚Äì Linha + Barra</h3>
  <div id="graficoPrincipal"></div>
</div>

<div class="card" style="margin-top:20px">
  <h3>Compara√ß√£o entre anos</h3>
  <select id="anoComparacao" onchange="atualizarTudo()"></select>
  <div id="graficoComparativo"></div>
</div>

</section>

<!-- PLANEJAMENTO -->
<section id="planejamento" class="section">

<div class="card">
  <h3>Hist√≥rico manual (opcional)</h3>
  <input id="nov2025" placeholder="Novembro / 2025">
  <input id="dez2025" placeholder="Dezembro / 2025">
  <button class="primary" onclick="salvarHistorico()">Salvar hist√≥rico</button>
</div>

<div class="card">
  <h3>Adicionar m√™s futuro</h3>
  <input type="month" id="mesManual">
  <input id="valorMesManual" placeholder="Valor do m√™s">
  <button class="primary" onclick="adicionarMesManual()">Salvar m√™s</button>
</div>

<div class="card">
  <h3>Meta do m√™s</h3>
  <input id="metaInput" placeholder="Ex: 15.000,00">
  <button class="primary" onclick="salvarMeta()">Salvar meta</button>
</div>

</section>

<!-- VENDAS -->
<section id="vendas" class="section">
  <div class="card">
    <h3>Nova venda</h3>
    <input id="vendaInput" placeholder="Ex: 2.090,00">
    <select id="percentual">
      <option value="6">6%</option>
      <option value="5">5%</option>
      <option value="4">4%</option>
      <option value="3">3%</option>
    </select>
    <button class="primary" onclick="adicionarVenda()">Adicionar venda</button>
  </div>
</section>

<!-- HIST√ìRICO -->
<section id="historico" class="section">
  <div class="card">
    <h3>Hist√≥rico de vendas</h3>
    <table>
      <thead>
        <tr><th>Data</th><th>Valor</th><th>%</th><th>Comiss√£o</th><th>A√ß√µes</th></tr>
      </thead>
      <tbody id="listaVendas"></tbody>
    </table>
  </div>
</section>

<!-- RELAT√ìRIO -->
<section id="relatorio" class="section">
  <div class="card">
    <h3>Relat√≥rio consolidado</h3>
    <table>
      <thead><tr><th>M√™s</th><th>Total</th></tr></thead>
      <tbody id="relatorioAnual"></tbody>
    </table>
  </div>
</section>

</main>
</div>

<script>
function num(v){return Number(v.replace(/\./g,"").replace(",","."))}
function moeda(v){return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}

let dados = JSON.parse(localStorage.getItem("controleVendas")) || {
  meta:0,
  vendas:[],
  historicoInicial:{"2025-11":null,"2025-12":null},
  mesesManuais:{}
};

function show(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function salvar(){
  localStorage.setItem("controleVendas",JSON.stringify(dados));
  atualizarTudo();
}

function salvarMeta(){
  dados.meta = num(metaInput.value||"0");
  salvar();
}

function salvarHistorico(){
  dados.historicoInicial["2025-11"] = num(nov2025.value||"0")||null;
  dados.historicoInicial["2025-12"] = num(dez2025.value||"0")||null;
  salvar();
}

function adicionarMesManual(){
  let mes = mesManual.value;
  let valor = num(valorMesManual.value||"0");
  if(!mes||valor<=0)return;
  dados.mesesManuais[mes]=valor;
  mesManual.value="";valorMesManual.value="";
  salvar();
}

function adicionarVenda(){
  let valor=num(vendaInput.value);
  if(valor<=0)return;
  let p=Number(percentual.value);
  dados.vendas.push({id:Date.now(),valor,perc:p,com:valor*p/100,data:new Date()});
  vendaInput.value="";
  salvar();
}

function editar(id){
  let v=dados.vendas.find(v=>v.id===id);
  let novo=prompt("Novo valor:",moeda(v.valor));
  if(!novo)return;
  v.valor=num(novo);
  v.com=v.valor*v.perc/100;
  salvar();
}

function excluir(id){
  if(confirm("Excluir venda?")){
    dados.vendas=dados.vendas.filter(v=>v.id!==id);
    salvar();
  }
}

let grafico,graficoComp;
function atualizarTudo(){
  let meses={};

  Object.entries(dados.historicoInicial).forEach(([k,v])=>{if(v)meses[k]=v});
  Object.entries(dados.mesesManuais).forEach(([k,v])=>{if(v)meses[k]=v});
  dados.vendas.forEach(v=>{
    let k=v.data.getFullYear()+"-"+String(v.data.getMonth()+1).padStart(2,"0");
    meses[k]=(meses[k]||0)+v.valor;
  });

  let labels=Object.keys(meses).sort();
  let valores=labels.map(l=>meses[l]);

  let total=valores.reduce((a,b)=>a+b,0);
  let com=dados.vendas.reduce((a,b)=>a+b.com,0);

  metaValor.innerText=moeda(dados.meta);
  totalVendido.innerText=moeda(total);
  faltaMeta.innerText=moeda(Math.max(dados.meta-total,0));
  totalComissao.innerText=moeda(com);

  let perc=dados.meta>0?Math.min((total/dados.meta)*100,100):0;
  barraMeta.style.width=perc+"%";
  percentualMeta.innerText=perc.toFixed(1)+"% da meta";

  let melhor=valores.indexOf(Math.max(...valores));
  melhorMes.innerText=labels[melhor]||"‚Äî";

  let crescimento=valores.length>1?
    ((valores[valores.length-1]-valores[valores.length-2])/
     Math.max(valores[valores.length-2],1))*100:0;
  document.getElementById("crescimento").innerText=crescimento.toFixed(1)+"%";

  listaVendas.innerHTML="";
  dados.vendas.forEach(v=>{
    listaVendas.innerHTML+=`
    <tr>
      <td>${v.data.toLocaleDateString("pt-BR")}</td>
      <td>${moeda(v.valor)}</td>
      <td>${v.perc}%</td>
      <td>${moeda(v.com)}</td>
      <td>
        <button onclick="editar(${v.id})">‚úèÔ∏è</button>
        <button onclick="excluir(${v.id})">üóëÔ∏è</button>
      </td>
    </tr>`;
  });

  relatorioAnual.innerHTML="";
  labels.forEach((l,i)=>relatorioAnual.innerHTML+=`<tr><td>${l}</td><td>${moeda(valores[i])}</td></tr>`);

  if(grafico)grafico.destroy();
  grafico=new ApexCharts(document.querySelector("#graficoPrincipal"),{
    chart:{height:350},
    series:[
      {name:"Vendas",type:"column",data:valores},
      {name:"Evolu√ß√£o",type:"line",data:valores}
    ],
    xaxis:{categories:labels},
    colors:["#6366f1","#22c55e"]
  });
  grafico.render();

  let anos=[...new Set(labels.map(l=>l.split("-")[0]))];
  anoComparacao.innerHTML=anos.map(a=>`<option>${a}</option>`).join("");
  let ano=anoComparacao.value||anos[anos.length-1];

  let a1=Array(12).fill(0),a2=Array(12).fill(0);
  Object.keys(meses).forEach(k=>{
    let [a,m]=k.split("-");
    if(a==ano)a1[m-1]+=meses[k];
    if(a==ano-1)a2[m-1]+=meses[k];
  });

  if(graficoComp)graficoComp.destroy();
  graficoComp=new ApexCharts(document.querySelector("#graficoComparativo"),{
    chart:{height:350},
    series:[
      {name:ano,data:a1},
      {name:ano-1,data:a2}
    ],
    xaxis:{categories:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"]},
    colors:["#6366f1","#22c55e"]
  });
  graficoComp.render();
}

function exportarPDF(){
  const { jsPDF }=window.jspdf;
  const pdf=new jsPDF();
  pdf.text("Relat√≥rio de Vendas",10,10);
  let y=20;
  dados.vendas.forEach(v=>{
    pdf.text(`${v.data.toLocaleDateString("pt-BR")} - ${moeda(v.valor)}`,10,y);
    y+=8;
  });
  pdf.save("relatorio-vendas.pdf");
}

function exportarExcel(){
  let ws=XLSX.utils.json_to_sheet(
    dados.vendas.map(v=>({
      Data:v.data.toLocaleDateString("pt-BR"),
      Valor:v.valor,
      Percentual:v.perc,
      Comiss√£o:v.com
    }))
  );
  let wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Vendas");
  XLSX.writeFile(wb,"vendas.xlsx");
}

atualizarTudo();
</script>
</body>
</html>

