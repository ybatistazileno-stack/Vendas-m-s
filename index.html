<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Vendas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#0b1020;
  --card:#111827;
  --primary:#6366f1;
  --green:#22c55e;
  --red:#ef4444;
  --text:#e5e7eb;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Segoe UI, Arial;
}
.hidden{display:none}
.container{
  max-width:1100px;
  margin:auto;
  padding:20px;
}
.card{
  background:var(--card);
  padding:20px;
  border-radius:16px;
  margin-bottom:20px;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}
input,select,button{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-top:8px;
}
button{
  background:var(--primary);
  color:white;
}
.valor{font-size:24px}
.green{color:var(--green)}
.red{background:var(--red)}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:10px;
  border-bottom:1px solid #1f2937;
  text-align:center;
}
.login{
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.login-box{
  background:var(--card);
  padding:30px;
  border-radius:16px;
  width:320px;
}
@media(max-width:600px){
  table{font-size:13px}
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="login">
  <div class="login-box">
    <h2>Login</h2>
    <input id="user" placeholder="Usuário">
    <input id="pass" type="password" placeholder="Senha">
    <button onclick="entrar()">Entrar</button>
    <p id="erro" style="color:#ef4444"></p>
  </div>
</div>

<!-- SISTEMA -->
<div id="sistema" class="hidden">
<div class="container">

<button class="red" onclick="sair()">Sair</button>

<div class="card">
<h3>Meta do mês</h3>
<input id="metaInput">
<button onclick="salvarMeta()">Salvar meta</button>
</div>

<div class="card">
<h3>Nova venda</h3>
<input id="vendaInput" placeholder="Ex: 2.090,00">
<select id="percentual">
<option value="6">6%</option>
<option value="5">5%</option>
<option value="4">4%</option>
<option value="3">3%</option>
</select>
<button onclick="adicionarVenda()">Adicionar</button>
</div>

<div class="grid">
<div class="card"><h4>Meta</h4><div id="meta" class="valor">R$ 0,00</div></div>
<div class="card"><h4>Total vendido</h4><div id="total" class="valor">R$ 0,00</div></div>
<div class="card"><h4>Falta</h4><div id="falta" class="valor">R$ 0,00</div></div>
<div class="card"><h4>Comissão</h4><div id="comissao" class="valor green">R$ 0,00</div></div>
</div>

<div class="card">
<h3>Gráfico de vendas</h3>
<canvas id="grafico"></canvas>
</div>

<div class="card">
<h3>Histórico</h3>
<table>
<thead>
<tr><th>Data</th><th>Venda</th><th>%</th><th>Comissão</th><th>Ação</th></tr>
</thead>
<tbody id="lista"></tbody>
</table>
</div>

</div>
</div>

<script>
// LOGIN
async function hash(txt){
  const buf=new TextEncoder().encode(txt);
  const hash=await crypto.subtle.digest("SHA-256",buf);
  return [...new Uint8Array(hash)].map(b=>b.toString(16).padStart(2,"0")).join("");
}
const USER="admin";
const PASS_HASH="03ac674216f3e15c761ee1a5e255f067953623c8b388b4459e13f978d7c846f4"; //1234

async function entrar(){
  if(user.value===USER && await hash(pass.value)===PASS_HASH){
    localStorage.setItem("sessao","ok");
    iniciar();
  }else erro.innerText="Login inválido";
}
function sair(){
  localStorage.removeItem("sessao");
  location.reload();
}

// SISTEMA
let dados=JSON.parse(localStorage.getItem("dados"))||{meta:0,vendas:[]};

function salvar(){localStorage.setItem("dados",JSON.stringify(dados));}
function num(v){return Number(v.replace(/\./g,"").replace(",",".")||0);}
function moeda(v){return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});}

function salvarMeta(){
  dados.meta=num(metaInput.value);
  salvar();atualizar();
}

function adicionarVenda(){
  const valor=num(vendaInput.value);
  if(valor<=0)return alert("Valor inválido");
  const p=Number(percentual.value);
  dados.vendas.push({
    data:new Date().toLocaleDateString("pt-BR"),
    valor,perc:p,com:valor*p/100
  });
  vendaInput.value="";
  salvar();atualizar();
}

function remover(i){
  dados.vendas.splice(i,1);
  salvar();atualizar();
}

let graf;
function atualizar(){
  meta.innerText=moeda(dados.meta);
  const totalV=dados.vendas.reduce((s,v)=>s+v.valor,0);
  const totalC=dados.vendas.reduce((s,v)=>s+v.com,0);
  total.innerText=moeda(totalV);
  comissao.innerText=moeda(totalC);
  falta.innerText=moeda(Math.max(dados.meta-totalV,0));

  lista.innerHTML="";
  let porDia={};
  dados.vendas.forEach((v,i)=>{
    lista.innerHTML+=`<tr>
    <td>${v.data}</td><td>${moeda(v.valor)}</td>
    <td>${v.perc}%</td><td>${moeda(v.com)}</td>
    <td><button class="red" onclick="remover(${i})">X</button></td></tr>`;
    porDia[v.data]=(porDia[v.data]||0)+v.valor;
  });

  if(graf)graf.destroy();
  graf=new Chart(grafico,{
    type:"line",
    data:{
      labels:Object.keys(porDia),
      datasets:[{data:Object.values(porDia),label:"Vendas",borderColor:"#6366f1",backgroundColor:"rgba(99,102,241,.3)",fill:true}]
    }
  });
}

function iniciar(){
  login.classList.add("hidden");
  sistema.classList.remove("hidden");
  atualizar();
}
if(localStorage.getItem("sessao")==="ok") iniciar();
</script>

</body>
</html>
