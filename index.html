<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Corporativo de Vendas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
:root{
  --bg:#0b1020;
  --sidebar:#0a0f1e;
  --card:#111827;
  --primary:#6366f1;
  --green:#22c55e;
  --text:#e5e7eb;
}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial;background:var(--bg);color:var(--text)}
.layout{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
aside{background:var(--sidebar);padding:20px}
aside h2{color:var(--primary)}
aside button{
  width:100%;background:#1f2937;color:#fff;border:none;
  padding:12px;border-radius:10px;margin-bottom:8px;text-align:left;cursor:pointer
}
aside button:hover{background:var(--primary)}
main{padding:25px}
.section{display:none}
.section.active{display:block}

.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px}
.card{background:var(--card);padding:20px;border-radius:16px}
.valor{font-size:26px;font-weight:bold}
.green{color:var(--green)}

input,select,button{
  width:100%;padding:12px;border-radius:10px;border:none;margin-top:10px
}
button.primary{background:var(--primary);color:#fff;cursor:pointer}

table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #1f2937;text-align:center}
td button{padding:6px 10px;border-radius:6px;border:none;cursor:pointer}

@media(max-width:900px){
  .layout{grid-template-columns:1fr}
  aside{display:flex;gap:10px;overflow:auto}
}
</style>
</head>

<body>
<div class="layout">

<!-- MENU -->
<aside>
  <h2>Vendas</h2>
  <button onclick="show('painel')">ğŸ“Š Painel</button>
  <button onclick="show('vendas')">â• Nova venda</button>
  <button onclick="show('historico')">ğŸ“ HistÃ³rico</button>
  <button onclick="exportarPDF()">ğŸ“„ PDF</button>
  <button onclick="exportarExcel()">ğŸ“Š Excel</button>
</aside>

<main>

<!-- PAINEL -->
<section id="painel" class="section active">
  <div class="cards">
    <div class="card"><h4>Total vendido</h4><div id="totalVendido" class="valor">R$ 0,00</div></div>
    <div class="card"><h4>ComissÃ£o</h4><div id="totalComissao" class="valor green">R$ 0,00</div></div>
  </div>
  <div class="card" style="margin-top:20px">
    <div id="grafico"></div>
  </div>
</section>

<!-- VENDAS -->
<section id="vendas" class="section">
  <div class="card">
    <h3>Nova venda</h3>

    <input id="vendaInput" placeholder="Valor da venda (ex: 2.090,00)">

    <select id="percentual">
      <option value="6">6% de comissÃ£o</option>
      <option value="5">5% de comissÃ£o</option>
      <option value="4">4% de comissÃ£o</option>
      <option value="3">3% de comissÃ£o</option>
    </select>

    <input id="clienteInput" placeholder="Nome completo do cliente">

    <select id="grupoProduto" onchange="carregarProdutos()">
      <option value="">Grupo do produto</option>
      <option value="Produtos">Produtos</option>
      <option value="AcessÃ³rios">AcessÃ³rios</option>
    </select>

    <select id="produtoSelect">
      <option value="">Produto</option>
    </select>

    <input id="descricaoProduto" placeholder="DescriÃ§Ã£o (cor / observaÃ§Ã£o â€“ opcional)">

    <button class="primary" onclick="adicionarVenda()">Adicionar venda</button>
  </div>
</section>

<!-- HISTÃ“RICO -->
<section id="historico" class="section">
  <div class="card">
    <h3>HistÃ³rico de vendas</h3>
    <table>
      <thead>
        <tr>
          <th>Data</th>
          <th>Cliente</th>
          <th>Produto</th>
          <th>Valor</th>
          <th>%</th>
          <th>ComissÃ£o</th>
          <th>AÃ§Ãµes</th>
        </tr>
      </thead>
      <tbody id="listaVendas"></tbody>
    </table>
  </div>
</section>

</main>
</div>

<script>
function num(v){return Number(v.replace(/\./g,"").replace(",","."))}
function moeda(v){return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}

/* BASE DE PRODUTOS */
const produtosBase = {
  "Produtos": [
    "ğŸ›ï¸ ColchÃ£o â€“ Casal â€“ 1,38 x 1,88 m",
    "ğŸ›ï¸ ColchÃ£o â€“ Queen â€“ 1,58 x 1,98 m",
    "ğŸ›ï¸ ColchÃ£o â€“ Super King â€“ 1,93 x 2,03 m",

    "ğŸªµ Base de cama (normal) â€“ Casal",
    "ğŸªµ Base de cama (normal) â€“ Queen",
    "ğŸ“¦ Base de cama (baÃº) â€“ Casal",
    "ğŸ“¦ Base de cama (baÃº) â€“ Queen",

    "ğŸªŸ Cabeceira â€“ Casal",
    "ğŸªŸ Cabeceira â€“ Queen",

    "ğŸ›‹ï¸ Colchonete â€“ Solteiro",
    "ğŸ›‹ï¸ Colchonete â€“ Casal"
  ],

  "AcessÃ³rios": [
    "ğŸ§¸ Travesseiro â€“ Suave Encosto â€“ Sleep",
    "ğŸ§¸ Travesseiro â€“ Suave Encosto â€“ Dino",

    "ğŸ’§ Protetor de colchÃ£o impermeÃ¡vel â€“ Casal â€“ 1,40 m",
    "ğŸ’§ Protetor de colchÃ£o impermeÃ¡vel â€“ Queen â€“ 1,60 m",
    "ğŸ’§ Protetor de colchÃ£o impermeÃ¡vel â€“ Super King â€“ 1,95 m"
  ]
};

function carregarProdutos(){
  produtoSelect.innerHTML = `<option value="">Produto</option>`;
  if(!grupoProduto.value) return;

  produtosBase[grupoProduto.value].forEach(p=>{
    produtoSelect.innerHTML += `<option value="${p}">${p}</option>`;
  });
}

/* DADOS */
let dados = JSON.parse(localStorage.getItem("controleVendas")) || { vendas:[] };

function show(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function salvar(){
  localStorage.setItem("controleVendas",JSON.stringify(dados));
  atualizar();
}

function adicionarVenda(){
  let valor=num(vendaInput.value);
  let cliente=clienteInput.value.trim();
  let produto=produtoSelect.value;
  let desc=descricaoProduto.value.trim();
  let p=Number(percentual.value);

  if(valor<=0||!cliente||!produto){
    alert("Preencha valor, cliente e produto");
    return;
  }

  dados.vendas.push({
    id:Date.now(),
    valor,cliente,produto,
    descricao:desc,
    perc:p,
    com:valor*p/100,
    data:new Date()
  });

  vendaInput.value="";
  clienteInput.value="";
  grupoProduto.value="";
  produtoSelect.innerHTML=`<option value="">Produto</option>`;
  descricaoProduto.value="";

  salvar();
}

function editar(id){
  let v=dados.vendas.find(v=>v.id===id);
  let novo=prompt("Novo valor:",moeda(v.valor));
  if(!novo)return;
  v.valor=num(novo);
  v.com=v.valor*v.perc/100;
  salvar();
}

function excluir(id){
  if(confirm("Excluir venda?")){
    dados.vendas=dados.vendas.filter(v=>v.id!==id);
    salvar();
  }
}

let chart;
function atualizar(){
  let total=dados.vendas.reduce((a,b)=>a+b.valor,0);
  let com=dados.vendas.reduce((a,b)=>a+b.com,0);

  totalVendido.innerText=moeda(total);
  totalComissao.innerText=moeda(com);

  listaVendas.innerHTML="";
  dados.vendas.forEach(v=>{
    listaVendas.innerHTML+=`
      <tr>
        <td>${v.data.toLocaleDateString("pt-BR")}</td>
        <td>${v.cliente}</td>
        <td>${v.produto}${v.descricao?`<br><small>${v.descricao}</small>`:""}</td>
        <td>${moeda(v.valor)}</td>
        <td>${v.perc}%</td>
        <td>${moeda(v.com)}</td>
        <td>
          <button onclick="editar(${v.id})">âœï¸</button>
          <button onclick="excluir(${v.id})">ğŸ—‘ï¸</button>
        </td>
      </tr>`;
  });

  if(chart)chart.destroy();
  chart=new ApexCharts(document.querySelector("#grafico"),{
    chart:{height:300},
    series:[{name:"Vendas",data:dados.vendas.map(v=>v.valor)}],
    xaxis:{categories:dados.vendas.map(v=>v.data.toLocaleDateString("pt-BR"))}
  });
  chart.render();
}

function exportarPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  pdf.text("RelatÃ³rio de Vendas",10,10);
  let y=20;
  dados.vendas.forEach(v=>{
    pdf.text(`${v.data.toLocaleDateString("pt-BR")} - ${v.cliente} - ${moeda(v.valor)}`,10,y);
    y+=8;
  });
  pdf.save("vendas.pdf");
}

function exportarExcel(){
  let ws=XLSX.utils.json_to_sheet(dados.vendas.map(v=>({
    Data:v.data.toLocaleDateString("pt-BR"),
    Cliente:v.cliente,
    Produto:v.produto,
    Valor:v.valor,
    ComissÃ£o:v.com
  })));
  let wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Vendas");
  XLSX.writeFile(wb,"vendas.xlsx");
}

atualizar();
</script>
</body>
</html>
