<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Vendas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#0b1020;
  --card:#111827;
  --primary:#6366f1;
  --green:#22c55e;
  --red:#ef4444;
  --text:#e5e7eb;
  --muted:#9ca3af;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Segoe UI,Arial;
}
.layout{
  display:grid;
  grid-template-columns:220px 1fr;
  min-height:100vh;
}
aside{
  background:#0a0f1e;
  padding:20px;
}
aside h2{color:var(--primary)}
aside button{
  width:100%;
  margin:6px 0;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#1f2937;
  color:white;
  cursor:pointer;
}
main{padding:20px}
.card{
  background:var(--card);
  padding:16px;
  border-radius:14px;
  margin-bottom:16px;
}
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:15px;
}
input,select,button{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:none;
  margin-top:8px;
}
button{
  background:var(--primary);
  color:white;
  cursor:pointer;
}
.valor{font-size:22px;font-weight:bold}
.green{color:var(--green)}
.red{background:var(--red)}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:8px;
  border-bottom:1px solid #1f2937;
  text-align:left;
}
td button{
  width:auto;
  padding:6px 10px;
  margin-right:5px;
}
.oculto{display:none}
@media(max-width:700px){
  .layout{grid-template-columns:1fr}
  aside{display:flex;gap:10px;overflow:auto}
}
</style>
</head>

<body>
<div class="layout">

<aside>
  <h2>Vendas</h2>
  <button onclick="mostrar('painel')">Painel</button>
  <button onclick="mostrar('historico')">Histórico</button>
  <button onclick="mostrar('relatorio')">Relatório anual</button>
</aside>

<main>

<!-- PAINEL -->
<section id="painel">
  <div class="card">
    <h3>Meta do mês (R$)</h3>
    <input id="metaInput" placeholder="Ex: 15000">
    <button onclick="salvarMeta()">Salvar meta</button>
  </div>

  <div class="card">
    <h3>Nova venda</h3>
    <input id="vendaInput" placeholder="Ex: 2.090,00">
    <select id="percentual">
      <option value="6">6%</option>
      <option value="5">5%</option>
      <option value="4">4%</option>
      <option value="3">3%</option>
    </select>
    <button onclick="adicionarVenda()">Adicionar venda</button>
  </div>

  <div class="cards">
    <div class="card"><div>Meta</div><div class="valor" id="metaValor">R$ 0,00</div></div>
    <div class="card"><div>Total vendido</div><div class="valor" id="totalVendido">R$ 0,00</div></div>
    <div class="card"><div>Falta para meta</div><div class="valor" id="faltaMeta">R$ 0,00</div></div>
    <div class="card"><div>Comissão</div><div class="valor green" id="totalComissao">R$ 0,00</div></div>
  </div>

  <div class="card">
    <h3>Gráfico de vendas do mês</h3>
    <canvas id="grafico"></canvas>
  </div>
</section>

<!-- HISTÓRICO -->
<section id="historico" class="oculto">
  <div class="card">
    <h3>Histórico de vendas (mês atual)</h3>
    <table>
      <thead>
        <tr><th>Data</th><th>Venda</th><th>%</th><th>Comissão</th><th>Ações</th></tr>
      </thead>
      <tbody id="listaVendas"></tbody>
    </table>
    <button class="red" onclick="limparMes()">Limpar mês</button>
  </div>
</section>

<!-- RELATÓRIO -->
<section id="relatorio" class="oculto">
  <div class="card">
    <h3>Relatório anual</h3>
    <table>
      <thead><tr><th>Mês</th><th>Total vendido</th></tr></thead>
      <tbody id="relatorioAnual"></tbody>
    </table>
  </div>
</section>

</main>
</div>

<script>
let dados = JSON.parse(localStorage.getItem("controleVendas")) || {
  meta:0,
  vendas:[]
};

function salvar(){
  localStorage.setItem("controleVendas",JSON.stringify(dados));
  atualizar();
}

function moeda(v){
  return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
}

function numero(v){
  return Number(v.replace(/\./g,"").replace(",","."));
}

function salvarMeta(){
  dados.meta = numero(metaInput.value||"0");
  salvar();
}

function adicionarVenda(){
  const valor = numero(vendaInput.value);
  if(valor<=0)return alert("Valor inválido");
  const p = Number(percentual.value);
  dados.vendas.push({
    id:Date.now(),
    valor,
    perc:p,
    data:new Date().toLocaleDateString("pt-BR"),
    mes:new Date().getMonth()
  });
  vendaInput.value="";
  salvar();
}

function editar(id){
  const novo = prompt("Novo valor da venda:");
  if(!novo)return;
  const v = dados.vendas.find(v=>v.id===id);
  v.valor = numero(novo);
  salvar();
}

function excluir(id){
  dados.vendas = dados.vendas.filter(v=>v.id!==id);
  salvar();
}

function limparMes(){
  const m=new Date().getMonth();
  dados.vendas=dados.vendas.filter(v=>v.mes!==m);
  salvar();
}

function mostrar(id){
  painel.classList.add("oculto");
  historico.classList.add("oculto");
  relatorio.classList.add("oculto");
  document.getElementById(id).classList.remove("oculto");
}

let chart;

function atualizar(){
  metaValor.innerText=moeda(dados.meta);
  const total=dados.vendas.reduce((s,v)=>s+v.valor,0);
  totalVendido.innerText=moeda(total);
  faltaMeta.innerText=moeda(Math.max(dados.meta-total,0));
  const com=dados.vendas.reduce((s,v)=>s+(v.valor*v.perc/100),0);
  totalComissao.innerText=moeda(com);

  listaVendas.innerHTML="";
  const mesAtual=new Date().getMonth();
  dados.vendas.filter(v=>v.mes===mesAtual).forEach(v=>{
    const c=v.valor*v.perc/100;
    listaVendas.innerHTML+=`
    <tr>
      <td>${v.data}</td>
      <td>${moeda(v.valor)}</td>
      <td>${v.perc}%</td>
      <td>${moeda(c)}</td>
      <td>
        <button onclick="editar(${v.id})">Editar</button>
        <button onclick="excluir(${v.id})">Excluir</button>
      </td>
    </tr>`;
  });

  relatorioAnual.innerHTML="";
  for(let m=0;m<12;m++){
    const t=dados.vendas.filter(v=>v.mes===m).reduce((s,v)=>s+v.valor,0);
    relatorioAnual.innerHTML+=`<tr><td>${m+1}</td><td>${moeda(t)}</td></tr>`;
  }

  const porDia={};
  dados.vendas.filter(v=>v.mes===mesAtual).forEach(v=>{
    porDia[v.data]=(porDia[v.data]||0)+v.valor;
  });

  if(chart) chart.destroy();
  chart=new Chart(grafico,{
    type:"line",
    data:{
      labels:Object.keys(porDia),
      datasets:[{
        label:"Vendas (R$)",
        data:Object.values(porDia),
        borderColor:"#6366f1",
        backgroundColor:"rgba(99,102,241,.3)",
        fill:true,
        tension:.4
      }]
    }
  });
}

atualizar();
</script>

</body>
</html>
