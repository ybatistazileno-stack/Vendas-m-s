<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Vendas</title>

<style>
:root{
  --bg:#0b1020;
  --card:#111827;
  --primary:#6366f1;
  --green:#22c55e;
  --red:#ef4444;
  --text:#e5e7eb;
  --muted:#9ca3af;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Segoe UI, Arial;
}

.hidden{display:none}

.layout{
  display:grid;
  grid-template-columns:240px 1fr;
  min-height:100vh;
}

/* LOGIN */
.login{
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
}

.login-box{
  background:var(--card);
  padding:30px;
  border-radius:16px;
  width:320px;
}

.login-box h2{text-align:center}

/* MENU */
.menu{
  background:#0a0f1e;
  padding:20px;
}

.menu h2{color:var(--primary)}

.menu button{
  width:100%;
  margin:6px 0;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#1f2937;
  color:var(--text);
  cursor:pointer;
}

.menu button:hover{background:#374151}

/* CONTE√öDO */
.main{padding:25px}

.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}

.card{
  background:var(--card);
  padding:20px;
  border-radius:16px;
}

input,select,button{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:none;
  margin-top:8px;
}

button.primary{background:var(--primary);color:white}
button.red{background:var(--red);color:white}
button.green{background:var(--green);color:white}

.valor{font-size:26px;font-weight:bold}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}

th,td{
  padding:10px;
  border-bottom:1px solid #1f2937;
  text-align:left;
}
th{color:var(--muted)}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="telaLogin" class="login">
  <div class="login-box">
    <h2>Acesso ao Painel</h2>
    <input id="loginUsuario" placeholder="Usu√°rio">
    <input id="loginSenha" type="password" placeholder="Senha">
    <button class="primary" onclick="entrar()">Entrar</button>
    <p id="loginErro" style="color:var(--red);text-align:center"></p>
  </div>
</div>

<!-- SISTEMA -->
<div id="sistema" class="layout hidden">

  <aside class="menu">
    <h2>Vendas</h2>
    <button onclick="mostrar('painel')">Painel</button>
    <button onclick="mostrar('historico')">Hist√≥rico</button>
    <button onclick="mostrar('anual')">Relat√≥rio anual</button>
    <button class="red" onclick="sair()">Sair</button>
  </aside>

  <main class="main">

    <!-- PAINEL -->
    <div id="painel">
      <div class="cards">
        <div class="card">
          <h4>Meta do m√™s</h4>
          <input id="metaInput">
          <button class="primary" onclick="salvarMeta()">Salvar meta</button>
        </div>

        <div class="card">
          <h4>Nova venda</h4>
          <input id="vendaInput">
          <select id="percentual">
            <option value="6">6%</option>
            <option value="5">5%</option>
            <option value="4">4%</option>
            <option value="3">3%</option>
          </select>
          <button class="primary" onclick="adicionarVenda()">Adicionar</button>
        </div>
      </div>

      <div class="cards" style="margin-top:20px">
        <div class="card"><h4>Meta</h4><div id="metaValor" class="valor">R$ 0,00</div></div>
        <div class="card"><h4>Total vendido</h4><div id="totalVendido" class="valor">R$ 0,00</div></div>
        <div class="card"><h4>Falta para meta</h4><div id="faltaMeta" class="valor">R$ 0,00</div></div>
        <div class="card"><h4>Comiss√£o</h4><div id="totalComissao" class="valor" style="color:var(--green)">R$ 0,00</div></div>
      </div>

      <div class="card" style="margin-top:20px">
        üëÅÔ∏è Visitantes do painel: <b id="visitantes">0</b>
      </div>
    </div>

    <!-- HIST√ìRICO -->
    <div id="historico" class="hidden">
      <div class="card">
        <h3>Hist√≥rico de vendas</h3>
        <table>
          <thead>
            <tr>
              <th>Data</th><th>Valor</th><th>%</th><th>Comiss√£o</th><th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="listaVendas"></tbody>
        </table>
      </div>
    </div>

    <!-- ANUAL -->
    <div id="anual" class="hidden">
      <div class="card">
        <h3>Relat√≥rio anual</h3>
        <table>
          <thead>
            <tr><th>M√™s</th><th>Total vendido</th><th>Comiss√£o</th></tr>
          </thead>
          <tbody id="relatorioAnual"></tbody>
        </table>
      </div>
    </div>

  </main>
</div>

<script>
// ===== LOGIN =====
const USUARIO_HASH = "admin";
const SENHA_HASH = "03ac674216f3e15c761ee1a5e255f067953623c8b388b4459e13f978d7c846f4"; // 1234

async function sha256(msg){
  const buf = new TextEncoder().encode(msg);
  const hash = await crypto.subtle.digest("SHA-256", buf);
  return [...new Uint8Array(hash)].map(b=>b.toString(16).padStart(2,"0")).join("");
}

async function entrar(){
  const u = loginUsuario.value;
  const s = await sha256(loginSenha.value);
  if(u===USUARIO_HASH && s===SENHA_HASH){
    localStorage.setItem("sessao","ativa");
    iniciar();
  } else {
    loginErro.innerText="Usu√°rio ou senha inv√°lidos";
  }
}

function sair(){
  localStorage.removeItem("sessao");
  location.reload();
}

// ===== SISTEMA =====
let dados = JSON.parse(localStorage.getItem("dadosVendas")) || {meta:0,vendas:[]};

function salvar(){localStorage.setItem("dadosVendas",JSON.stringify(dados));}

function parseValor(v){return Number(v.replace(/\./g,"").replace(",",".")||0);}
function moeda(v){return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});}

function salvarMeta(){
  dados.meta=parseValor(metaInput.value);
  salvar();atualizar();
}

function adicionarVenda(){
  const valor=parseValor(vendaInput.value);
  if(valor<=0)return alert("Valor inv√°lido");
  const p=Number(percentual.value);
  dados.vendas.push({
    data:new Date().toLocaleDateString("pt-BR"),
    valor,perc:p,com:valor*p/100
  });
  salvar();vendaInput.value="";atualizar();
}

function removerVenda(i){
  dados.vendas.splice(i,1);
  salvar();atualizar();
}

function atualizar(){
  const total=dados.vendas.reduce((s,v)=>s+v.valor,0);
  const com=dados.vendas.reduce((s,v)=>s+v.com,0);
  metaValor.innerText=moeda(dados.meta);
  totalVendido.innerText=moeda(total);
  totalComissao.innerText=moeda(com);
  faltaMeta.innerText=moeda(Math.max(dados.meta-total,0));

  listaVendas.innerHTML="";
  dados.vendas.forEach((v,i)=>{
    listaVendas.innerHTML+=`
      <tr>
        <td>${v.data}</td>
        <td>${moeda(v.valor)}</td>
        <td>${v.perc}%</td>
        <td>${moeda(v.com)}</td>
        <td><button class="red" onclick="removerVenda(${i})">Excluir</button></td>
      </tr>`;
  });

  const anual={};
  dados.vendas.forEach(v=>{
    const m=v.data.split("/")[1];
    anual[m]=anual[m]||{v:0,c:0};
    anual[m].v+=v.valor;
    anual[m].c+=v.com;
  });
  relatorioAnual.innerHTML="";
  Object.keys(anual).forEach(m=>{
    relatorioAnual.innerHTML+=`
      <tr><td>${m}</td><td>${moeda(anual[m].v)}</td><td>${moeda(anual[m].c)}</td></tr>`;
  });
}

function mostrar(id){
  painel.classList.add("hidden");
  historico.classList.add("hidden");
  anual.classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}

// VISITANTES
let vis = Number(localStorage.getItem("visitas")||0)+1;
localStorage.setItem("visitas",vis);
visitantes.innerText=vis;

function iniciar(){
  telaLogin.classList.add("hidden");
  sistema.classList.remove("hidden");
  atualizar();
}

if(localStorage.getItem("sessao")==="ativa") iniciar();
</script>

</body>
</html>
