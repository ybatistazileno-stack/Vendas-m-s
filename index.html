<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Profissional de Vendas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<style>
:root{
  --bg:#0b1020;--sidebar:#0a0f1e;--card:#111827;
  --primary:#6366f1;--green:#22c55e;
  --red:#ef4444;--text:#e5e7eb;--muted:#9ca3af;
}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial;background:var(--bg);color:var(--text)}
.layout{display:grid;grid-template-columns:260px 1fr;min-height:100vh}

/* MENU */
aside{
  background:linear-gradient(180deg,#0a0f1e,#020617);
  padding:20px
}
aside h2{color:var(--primary);margin-bottom:25px}
aside button{
  width:100%;background:transparent;color:#c7d2fe;border:none;
  padding:14px;border-radius:12px;margin-bottom:8px;
  text-align:left;cursor:pointer;transition:.2s;font-size:15px
}
aside button:hover{background:#1f2937}
aside button.active{background:var(--primary);color:#fff}

main{padding:25px}
.section{display:none}
.section.active{display:block}

/* CARDS */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px
}
.card{
  background:var(--card);
  padding:20px;
  border-radius:18px;
  animation:fade .4s ease
}
@keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1}}
.valor{font-size:26px;font-weight:bold}
.green{color:var(--green)}
.red{color:var(--red)}
.muted{color:var(--muted)}

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px
}
.clock{
  text-align:right;
  font-size:14px;
  color:var(--muted)
}
.clock span{
  display:block;
  font-size:20px;
  color:var(--text)
}

/* FORM */
input,select,button{
  width:100%;padding:12px;border-radius:12px;border:none;margin-top:10px;
  font-size:16px
}
input,select{background:#f9fafb;color:#111827}
button.primary{
  background:var(--primary);
  color:white;
  cursor:pointer;
  transition:.3s
}
button.primary.saved{
  background:#16a34a;
}

/* HIST */
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #1f2937;vertical-align:top}
.item-chip{
  background:#1f2937;padding:6px 10px;border-radius:8px;
  font-size:13px;margin:3px 0
}

@media(max-width:900px){
  .layout{grid-template-columns:1fr}
  aside{display:flex;gap:10px;overflow:auto}
}
</style>
</head>

<body>

<div class="layout">

<aside>
  <h2>Vendas</h2>
  <button onclick="show('painel',this)" class="active">üìä Painel</button>
  <button onclick="show('meta',this)">üéØ Meta do m√™s</button>
  <button onclick="show('vendas',this)">‚ûï Nova venda</button>
  <button onclick="show('historico',this)">üìÅ Hist√≥rico</button>
</aside>

<main>

<!-- PAINEL -->
<section id="painel" class="section active">

  <div class="topbar">
    <h2>Painel</h2>
    <div class="clock">
      <span id="hora"></span>
      <small id="data"></small>
    </div>
  </div>

  <div class="cards">
    <div class="card"><div class="muted">M√™s ativo</div><div id="mesTexto" class="valor"></div></div>
    <div class="card"><div class="muted">Total vendido</div><div id="totalVendido" class="valor"></div></div>
    <div class="card"><div class="muted">Venda da semana</div><div id="vendaSemana" class="valor"></div></div>
    <div class="card"><div class="muted">Comiss√£o</div><div id="totalComissao" class="valor green"></div></div>
  </div>

  <div class="cards" style="margin-top:20px">
    <div class="card"><h4>Meta do m√™s</h4><div id="donutMeta"></div></div>
    <div class="card"><h4>Vendas da semana</h4><div id="graficoSemana"></div></div>
  </div>

</section>

<!-- META -->
<section id="meta" class="section">
  <div class="card">
    <h3>Configura√ß√£o mensal</h3>
    <select id="mesAtivo"></select>
    <input id="metaMes" placeholder="Meta do m√™s">
    <button class="primary" onclick="salvarMeta(this)">Salvar meta</button>
  </div>
</section>

<!-- VENDAS (INALTERADO) -->
<section id="vendas" class="section">
  <div class="card">
    <h3>Nova venda</h3>

    <input id="valorVenda" placeholder="Valor total da venda">
    <select id="percentual">
      <option value="6">6%</option>
      <option value="5">5%</option>
      <option value="4">4%</option>
      <option value="3">3%</option>
    </select>

    <input id="clienteVenda" placeholder="Nome do cliente">

    <h4 style="margin-top:20px">Itens da venda</h4>

    <select id="grupoItem">
      <option>Produtos</option>
      <option>Acess√≥rios</option>
    </select>

    <select id="tipoItem">
      <option>Colch√£o</option>
      <option>Base</option>
      <option>Colchonet</option>
      <option>Acess√≥rio</option>
    </select>

    <input id="descricaoItem" placeholder="Descri√ß√£o do item">
    <input id="quantidadeItem" type="number" min="1" placeholder="Quantidade">

    <button class="primary" onclick="addItem(this)">Adicionar item</button>

    <div id="listaItens"></div>

    <button class="primary" onclick="salvarVenda(this)">Salvar venda</button>
  </div>
</section>

<!-- HIST√ìRICO (INALTERADO) -->
<section id="historico" class="section">
  <div class="card">
    <h3>Hist√≥rico do m√™s</h3>
    <table>
      <thead>
        <tr><th>Data</th><th>Cliente</th><th>Venda</th><th>Itens</th></tr>
      </thead>
      <tbody id="listaVendas"></tbody>
    </table>
  </div>
</section>

</main>
</div>

<script>
const mesesNomes=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
function moeda(v){return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}
function num(v){return Number(v.replace(/\./g,"").replace(",","."))}

let dados=JSON.parse(localStorage.getItem("controleVendas"))||{mesAtivo:"",meses:{}};
let itensTemp=[];

function show(id,btn){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.querySelectorAll("aside button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}

function feedback(btn){
  let t=btn.innerText;
  btn.innerText="Salvo com sucesso ‚úì";
  btn.classList.add("saved");
  setTimeout(()=>{
    btn.innerText=t;
    btn.classList.remove("saved");
  },1500);
}

/* REL√ìGIO */
setInterval(()=>{
  let d=new Date();
  hora.innerText=d.toLocaleTimeString("pt-BR");
  data.innerText=d.toLocaleDateString("pt-BR",{weekday:"long",day:"2-digit",month:"long",year:"numeric"});
},1000);

function init(){
  let hoje=new Date();
  let mes=hoje.getFullYear()+"-"+String(hoje.getMonth()+1).padStart(2,"0");
  if(!dados.mesAtivo)dados.mesAtivo=mes;
  if(!dados.meses[mes])dados.meses[mes]={meta:0,vendas:[]};
  renderMeses();
  atualizar();
}

function renderMeses(){
  mesAtivo.innerHTML="";
  let ano=new Date().getFullYear();
  for(let i=0;i<12;i++){
    let m=ano+"-"+String(i+1).padStart(2,"0");
    mesAtivo.innerHTML+=`<option value="${m}">${mesesNomes[i]}</option>`;
  }
  mesAtivo.value=dados.mesAtivo;
  metaMes.value=dados.meses[dados.mesAtivo].meta||"";
}

function salvarMeta(btn){
  let m=mesAtivo.value;
  dados.mesAtivo=m;
  if(!dados.meses[m])dados.meses[m]={meta:0,vendas:[]};
  dados.meses[m].meta=num(metaMes.value||"0");
  salvar();feedback(btn);
}

function addItem(btn){
  itensTemp.push({
    grupo:grupoItem.value,
    tipo:tipoItem.value,
    descricao:descricaoItem.value,
    quantidade:Number(quantidadeItem.value)
  });
  listaItens.innerHTML+=`<div class="item-chip">${tipoItem.value} ‚Äì ${descricaoItem.value} | Qtd:${quantidadeItem.value}</div>`;
  descricaoItem.value="";quantidadeItem.value="";
  feedback(btn);
}

function salvarVenda(btn){
  let m=dados.mesAtivo;
  dados.meses[m].vendas.push({
    valor:num(valorVenda.value),
    cliente:clienteVenda.value,
    perc:Number(percentual.value),
    com:num(valorVenda.value)*Number(percentual.value)/100,
    itens:itensTemp,
    data:new Date()
  });
  itensTemp=[];listaItens.innerHTML="";
  salvar();feedback(btn);
}

function salvar(){
  localStorage.setItem("controleVendas",JSON.stringify(dados));
  atualizar();
}

let donut,bar;
function atualizar(){
  let m=dados.mesAtivo;
  let mes=dados.meses[m];
  let total=mes.vendas.reduce((a,b)=>a+b.valor,0);
  let com=mes.vendas.reduce((a,b)=>a+b.com,0);

  mesTexto.innerText=mesesNomes[Number(m.split("-")[1])-1];
  totalVendido.innerText=moeda(total);
  totalComissao.innerText=moeda(com);

  let inicioSemana=new Date();inicioSemana.setDate(inicioSemana.getDate()-inicioSemana.getDay());
  let semana=mes.vendas.filter(v=>new Date(v.data)>=inicioSemana).reduce((a,b)=>a+b.valor,0);
  vendaSemana.innerText=moeda(semana);

  listaVendas.innerHTML="";
  mes.vendas.forEach(v=>{
    listaVendas.innerHTML+=`
      <tr>
        <td>${v.data.toLocaleDateString("pt-BR")}</td>
        <td>${v.cliente}</td>
        <td>${moeda(v.valor)}</td>
        <td>${v.itens.map(i=>`${i.tipo} ‚Äì ${i.descricao} | Qtd:${i.quantidade}`).join("<br>")}</td>
      </tr>`;
  });

  if(donut)donut.destroy();
  donut=new ApexCharts(donutMeta,{
    chart:{type:"donut"},
    series:[total,Math.max(mes.meta-total,0)],
    labels:["Vendido","Falta para meta"],
    colors:["#22c55e","#6366f1"]
  });
  donut.render();

  if(bar)bar.destroy();
  bar=new ApexCharts(graficoSemana,{
    chart:{type:"bar"},
    series:[{name:"Semana",data:[semana]}],
    xaxis:{categories:["Atual"]},
    colors:["#6366f1"]
  });
  bar.render();
}

init();
</script>

</body>
</html>
