<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Sistema Corporativo de Vendas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
:root{
  --bg:#0b1020; --sidebar:#0a0f1e; --card:#111827;
  --primary:#6366f1; --green:#22c55e; --text:#e5e7eb;
}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial;background:var(--bg);color:var(--text)}
.hidden{display:none}

/* LOGIN */
.login{display:flex;align-items:center;justify-content:center;height:100vh}
.login-box{background:var(--card);padding:28px;border-radius:16px;max-width:360px;width:100%}
.login-box h2{text-align:center;color:var(--primary)}
.login-box input,.login-box button{width:100%;padding:12px;border-radius:10px;border:none;margin-top:10px}
.login-box button{background:var(--primary);color:#fff;cursor:pointer}

/* APP */
.layout{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
aside{background:var(--sidebar);padding:20px}
aside h2{color:var(--primary)}
aside button{
  width:100%;background:#1f2937;color:#fff;border:none;
  padding:12px;border-radius:10px;margin-bottom:8px;text-align:left;cursor:pointer
}
aside button:hover{background:var(--primary)}
main{padding:25px}
.section{display:none}.active{display:block}

.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px}
.card{background:var(--card);padding:20px;border-radius:16px}
.valor{font-size:26px;font-weight:bold}
.green{color:var(--green)}

input,button{width:100%;padding:12px;border-radius:10px;border:none;margin-top:10px}
button.primary{background:var(--primary);color:#fff;cursor:pointer}

table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:10px;border-bottom:1px solid #1f2937;text-align:center}

@media(max-width:900px){
  .layout{grid-template-columns:1fr}
  aside{display:flex;gap:10px;overflow:auto}
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="login">
  <div class="login-box">
    <h2>Login</h2>
    <input id="user" placeholder="Usu√°rio" />
    <input id="pass" type="password" placeholder="Senha" />
    <button onclick="entrar()">Entrar</button>
  </div>
</div>

<!-- APP -->
<div id="app" class="layout hidden">
  <aside>
    <h2>Vendas</h2>
    <button onclick="show('painel')">üìä Painel</button>
    <button class="admin-only" onclick="show('planejamento')">üß† Planejamento</button>
    <button class="admin-only" onclick="show('vendas')">‚ûï Lan√ßar venda</button>
    <button onclick="show('historico')">üìÅ Hist√≥rico</button>
    <button onclick="show('relatorios')">üìÜ Relat√≥rios</button>
    <button class="admin-only" onclick="pdfSemanal()">üñ®Ô∏è PDF semanal</button>
    <button class="admin-only" onclick="pdfMensal()">üñ®Ô∏è PDF mensal</button>
    <button onclick="sair()">üö™ Sair</button>
  </aside>

  <main>
    <section id="painel" class="section active">
      <div class="cards">
        <div class="card">
          <h4>Previsto</h4>
          <div id="previstoTotal" class="valor">R$ 0,00</div>
        </div>
        <div class="card">
          <h4>Realizado</h4>
          <div id="realizadoTotal" class="valor green">R$ 0,00</div>
        </div>
      </div>
      <div class="card" style="margin-top:20px">
        <div id="grafico"></div>
      </div>
    </section>

    <section id="planejamento" class="section">
      <div class="card">
        <h3>Previs√£o mensal</h3>
        <input type="month" id="mesPrevisto" />
        <input id="valorPrevisto" placeholder="Valor previsto" />
        <button class="primary" onclick="addPrevisto()">Salvar</button>
      </div>
    </section>

    <section id="vendas" class="section">
      <div class="card">
        <h3>Lan√ßar venda</h3>
        <input type="month" id="mesVenda" />
        <input id="valorVenda" placeholder="Valor da venda" />
        <button class="primary" onclick="addVenda()">Adicionar</button>
      </div>
    </section>

    <section id="historico" class="section">
      <div class="card">
        <h3>Hist√≥rico mensal</h3>
        <table>
          <thead>
            <tr><th>M√™s</th><th>Previsto</th><th>Realizado</th></tr>
          </thead>
          <tbody id="listaMeses"></tbody>
        </table>
      </div>
    </section>

    <section id="relatorios" class="section">
      <div class="card">
        <h3>Relat√≥rio autom√°tico</h3>
        <table>
          <thead>
            <tr><th>M√™s</th><th>Previsto</th><th>Realizado</th><th>%</th></tr>
          </thead>
          <tbody id="relatorioAuto"></tbody>
        </table>
      </div>
    </section>
  </main>
</div>

<script>
/* LOGIN */
const USERS={admin:{pass:"admin",perfil:"admin"},viewer:{pass:"viewer",perfil:"viewer"}};
let perfil=localStorage.getItem("perfil");

function entrar(){
  if(USERS[user.value] && USERS[user.value].pass===pass.value){
    localStorage.setItem("logado","1");
    localStorage.setItem("perfil",USERS[user.value].perfil);
    perfil=USERS[user.value].perfil;
    iniciar();
  } else alert("Login inv√°lido");
}
function sair(){localStorage.clear();location.reload();}
function iniciar(){
  login.classList.add("hidden");
  app.classList.remove("hidden");
  if(perfil==="viewer"){
    document.querySelectorAll(".admin-only").forEach(e=>e.style.display="none");
  }
  atualizar();
}
if(localStorage.getItem("logado")) iniciar();

/* UTIL */
function num(v){return Number(String(v).replace(/\./g,"").replace(",","."))}
function moeda(v){return v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}

/* DADOS */
let dados=JSON.parse(localStorage.getItem("dados"))||{previsto:{},realizado:{}};

function show(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* A√á√ïES */
function addPrevisto(){
  let m=mesPrevisto.value,v=num(valorPrevisto.value||0);
  if(!m||v<=0)return;
  dados.previsto[m]=(dados.previsto[m]||0)+v;
  salvar();
}
function addVenda(){
  let m=mesVenda.value,v=num(valorVenda.value||0);
  if(!m||v<=0)return;
  dados.realizado[m]=(dados.realizado[m]||0)+v;
  salvar();
}

/* ATUALIZA */
let chart;
function atualizar(){
  localStorage.setItem("dados",JSON.stringify(dados));
  let meses=[...new Set([...Object.keys(dados.previsto),...Object.keys(dados.realizado)])].sort();
  let p=meses.map(m=>dados.previsto[m]||0);
  let r=meses.map(m=>dados.realizado[m]||0);

  previstoTotal.innerText=moeda(p.reduce((a,b)=>a+b,0));
  realizadoTotal.innerText=moeda(r.reduce((a,b)=>a+b,0));

  listaMeses.innerHTML="";
  relatorioAuto.innerHTML="";
  meses.forEach((m,i)=>{
    listaMeses.innerHTML+=`<tr><td>${m}</td><td>${moeda(p[i])}</td><td>${moeda(r[i])}</td></tr>`;
    let perc=p[i]>0?(r[i]/p[i]*100):0;
    relatorioAuto.innerHTML+=`<tr><td>${m}</td><td>${moeda(p[i])}</td><td>${moeda(r[i])}</td><td>${perc.toFixed(1)}%</td></tr>`;
  });

  if(chart)chart.destroy();
  chart=new ApexCharts(document.querySelector("#grafico"),{
    chart:{height:300},
    series:[{name:"Previsto",data:p},{name:"Realizado",data:r}],
    xaxis:{categories:meses}
  });
  chart.render();
}

/* PDFs PARA IMPRESS√ÉO */
function pdfSemanal(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  pdf.text("Relat√≥rio Semanal de Vendas",10,10);
  pdf.text("Gerado em: "+new Date().toLocaleDateString("pt-BR"),10,20);
  pdf.text("Total realizado: "+realizadoTotal.innerText,10,35);
  pdf.save("relatorio-semanal.pdf");
}

function pdfMensal(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  pdf.text("Relat√≥rio Mensal de Vendas",10,10);
  let y=25;
  Object.keys(dados.realizado).sort().forEach(m=>{
    pdf.text(`${m} - ${moeda(dados.realizado[m])}`,10,y);
    y+=8;
  });
  pdf.save("relatorio-mensal.pdf");
}
</script>
</body>
</html>

